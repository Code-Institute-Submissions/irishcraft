{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="main">
    <div class="container marketing">
        <div class="row mx-md-n5">
            <div class="col-12 px-md-10 d-flex justify-content-center">
                {% if search %}
                <h6>Your search for <strong>"{{search.capitalize}}"</strong> returned <strong>{{ products.count }}
                    </strong>results</h6>
                {% endif %}
            </div>
        </div>
        <div class="row">
            <div class="col">
                <ul class="navbar-nav ml-auto mb-2 mb-md-0 d-lg-flex align-items-left text-muted">
                    <li class="nav-item dropdown">
                        <a class="logo-font font-weight-bold nav-link  link-dark mr-5 text-muted" href="#" id="all-products-link"
                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Sort by <i class="fas fa-chevron-down"></i>
                        </a>
                        <div class="dropdown-menu border-0" aria-labelledby="all-products-link">
                            <a href="{% url 'products' %}?sort=price&direction=asc" class="dropdown-item">By Price</a>
                            <a href="{% url 'products' %}?sort=rating&direction=desc" class="dropdown-item ">By
                                Rating</a>
                            <a href="{% url 'products' %}?sort=category&direction=asc" class="dropdown-item ">By
                                Category</a>
                            <a href="{% url 'products' %}" class="dropdown-item">All Products</a>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        <div class="row">
            {% for product in page_obj %}
            <div class="col-sm-6 col-lg-4">
                <div class="card-deck">
                    <div class="card">
                        {% if product.image_url != None %}
                            <a href="{% url 'product_details' product.id %}">
                                <img class="card-img-top" src="{{ product.image_url }}" alt="{{product.name}}">
                            </a>    
                        {% elif "No%20Image" not in product.image.url %}
                            <a href="{% url 'product_details' product.id %}">
                                <img class="card-img-top" src="{{ product.image.url }}" alt="{{product.name}}">
                            </a>
                        {% else %} 
                            <a href="{% url 'product_details' product.id %}">
                                <img class="card-img-top" src="https://demofree.sirv.com/products/123456/123456.jpg?profile=error-example" alt="{{product.name}}">
                            </a>
                        {% endif %}
                        <div class="card-body">
                            <p class="card-text">{{product.name}}</p>
                            <p class="small mt-1 mb-0" >
                                <a class="text-muted" href="{% url 'products' %}?category={{ product.category.name }}">
                                    <i class="fas fa-tag mr-1" ></i>{{ product.category.friendly_name }}
                                </a>
                            </p>
                        </div>
                        <div class="card-footer">
                            <p class="card-text">€ {{product.price}}</p>
                            <p><a class="btn btn-secondary" href="{% url 'product_details' product.id %}">View details
                                    »</a></p>


                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <nav aria-label="Products list">
            <ul class="pagination step-links list-inline justify-content-center">
                {% if page_obj.has_previous %}
                <li class="page-item"> <a class="page-link" href="?page=1">&laquo; first</a></li>
                <li class="page-item"> <a class="page-link"
                        href="?page={{ page_obj.previous_page_number }}">previous</a></li>
                {% endif %}
                <li class="page-item disabled">
                    <span class="current page-link">
                        Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
                    </span>
                </li>
                {% if page_obj.has_next %}
                <li class="page-item"> <a class="page-link" href="?page={{ page_obj.next_page_number }}">next</a></li>
                <li class="page-item"> <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">last
                        &raquo;</a></li>
                {% endif %}
            </ul>
        </nav>
    </div><!-- /.container -->
</div><!-- /.main -->
{% endblock %}

{% block postloadjs %}
<script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
<script src="{% static 'js/script.js' %}"></script>
{% endblock %}